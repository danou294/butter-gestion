{% extends 'scripts_manager/base.html' %}

{% block title %}{% if action == 'create' %}Nouveau Restaurant{% else %}Modifier Restaurant{% endif %} - Butter{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-[#FFFFFF] rounded-[14px] shadow-sm p-6 border border-[#C9C1B1]">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <h1 class="text-3xl font-serif font-bold text-[#111111]">
                {% if action == 'create' %}‚ûï Nouveau Restaurant{% else %}‚úèÔ∏è Modifier Restaurant{% endif %}
            </h1>
            <a href="{% url 'scripts_manager:restaurants_list' %}" class="btn-secondary">
                ‚Üê Retour
            </a>
        </div>
    </div>
    
    {% if error %}
    <div class="bg-[#F2D7D4] border border-[#D3695E] rounded-[14px] p-4 text-[#D3695E]">
        ‚ùå Erreur : {{ error }}
    </div>
    {% endif %}
    
    <!-- Form -->
    <div class="bg-[#FFFFFF] rounded-[14px] shadow-sm p-6 border border-[#C9C1B1]">
        <form method="POST" class="space-y-6">
            {% csrf_token %}
            
            <div>
                <label for="name" class="block text-sm font-medium text-[#111111] mb-2">Nom *</label>
                <input type="text" id="name" name="name" value="{{ restaurant.name|default:'' }}" required
                       class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
            </div>
            
            <div>
                <label for="address" class="block text-sm font-medium text-[#111111] mb-2">Adresse</label>
                <input type="text" id="address" name="address" value="{{ restaurant.address|default:'' }}"
                       class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="ville" class="block text-sm font-medium text-[#111111] mb-2">Ville</label>
                    <input type="text" id="ville" name="ville" value="{{ restaurant.ville|default:'' }}"
                           class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
                </div>
                <div>
                    <label for="codePostal" class="block text-sm font-medium text-[#111111] mb-2">Code Postal</label>
                    <input type="text" id="codePostal" name="codePostal" value="{{ restaurant.codePostal|default:'' }}"
                           class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="telephone" class="block text-sm font-medium text-[#111111] mb-2">T√©l√©phone</label>
                    <input type="text" id="telephone" name="telephone" value="{{ restaurant.telephone|default:'' }}"
                           class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-[#111111] mb-2">Email</label>
                    <input type="email" id="email" name="email" value="{{ restaurant.email|default:'' }}"
                           class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
                </div>
            </div>
            
            <div>
                <label for="siteWeb" class="block text-sm font-medium text-[#111111] mb-2">Site Web</label>
                <input type="url" id="siteWeb" name="siteWeb" value="{{ restaurant.siteWeb|default:'' }}"
                       class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
            </div>
            
            <div>
                <label for="description" class="block text-sm font-medium text-[#111111] mb-2">Description</label>
                <textarea id="description" name="description" rows="4"
                          class="w-full px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">{{ restaurant.description|default:'' }}</textarea>
            </div>
            
            <!-- Champs personnalis√©s -->
            <div class="bg-[#F1EFEB] rounded-[14px] p-4 border border-[#C9C1B1]">
                <h3 class="text-lg font-serif font-bold text-[#111111] mb-3">Champs personnalis√©s</h3>
                <p class="text-sm text-[#535353] mb-4">
                    Ajoutez des champs suppl√©mentaires au format JSON. Chaque ligne doit √™tre au format : <code class="bg-[#FFFFFF] px-2 py-1 rounded-[14px]">nom_champ: valeur</code>
                </p>
                <div id="custom-fields" class="space-y-3">
                    <button type="button" onclick="addCustomField()" class="btn-secondary">
                        ‚ûï Ajouter un champ
                    </button>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="flex flex-col md:flex-row gap-3 pt-4">
                <button type="submit" class="btn-primary flex-1">
                    üíæ {% if action == 'create' %}Cr√©er{% else %}Enregistrer{% endif %}
                </button>
                <a href="{% url 'scripts_manager:restaurants_list' %}" class="btn-secondary flex-1 text-center">
                    Annuler
                </a>
            </div>
        </form>
    </div>
</div>

<script>
let customFieldIndex = 0;

function addCustomField() {
    const container = document.getElementById('custom-fields');
    const fieldDiv = document.createElement('div');
    fieldDiv.className = 'flex gap-3 items-center';
    fieldDiv.innerHTML = `
        <input type="text" name="custom_field_name_${customFieldIndex}" placeholder="Nom du champ" 
               class="flex-1 px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]" required>
        <input type="text" name="custom_field_value_${customFieldIndex}" placeholder="Valeur" 
               class="flex-2 px-4 py-3 border border-[#C9C1B1] rounded-[14px] focus:ring-2 focus:ring-[#535353] focus:border-transparent bg-[#F1EFEB] text-[#111111]">
        <button type="button" onclick="this.parentElement.remove()" class="btn-danger">
            üóëÔ∏è
        </button>
    `;
    container.appendChild(fieldDiv);
    customFieldIndex++;
}

// Charger les champs personnalis√©s existants
{% if restaurant %}
{% for key, value in restaurant.items %}
{% if key != 'id' and key != 'name' and key != 'Name' and key != 'nom' and key != 'address' and key != 'adresse' and key != 'ville' and key != 'codePostal' and key != 'telephone' and key != 'email' and key != 'siteWeb' and key != 'description' %}
addCustomField();
const fields = document.querySelectorAll('#custom-fields input');
if (fields.length >= 2) {
    fields[fields.length - 2].value = '{{ key }}';
    fields[fields.length - 1].value = '{{ value|stringformat:"s" }}';
}
{% endif %}
{% endfor %}
{% endif %}
</script>
{% endblock %}
